<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="improvedHeader" class="headr">
    <div th:insert="components :: header" ></div>
    <div th:insert="components :: loggedAsAndLogout" ></div>
    <hr>
</div>
<div th:fragment="improvedFooter" class="footr">
    <hr>
    <div th:insert="components :: backToList" ></div>
    <div th:insert="components :: backHome" ></div>
    <div th:insert="components :: footer" ></div>
</div>
<footer th:fragment="footer">
    <hr>
    <p>Â© 2019 Kirichenok Egor and Kunec Alexey, EPAM Systems</p>
</footer>
<header th:fragment="header">
    <h2>Datch Auction</h2>
    <hr>
</header>
<div th:fragment="userMenu" class="widget">
    <h3 class="widget-title">Menu</h3>
    <ul class="widget-list">
        <li><a th:href="@{/auctionList}">Auction list</a></li>
        <li><a th:href="@{/activeAuctionList}">Active auctions</a></li>
        <li><a th:href="@{/allLotList}">Lots</a></li>
        <li><a sec:authorize="hasRole('ADMIN') || hasRole('SELLER')" th:href="@{/freeItems}">Free items</a></li>
        <li><a sec:authorize="hasRole('ADMIN') || hasRole('SELLER')" th:href="@{/soldLotList}">Purchase</a></li>
    </ul>
</div>
<div th:fragment="backHome">
    <a th:href="@{/home}">Back to the home page</a>
</div>
<!--<div th:fragment="aucList">-->
<!--    <table border="1" cellspacing="0">-->
<!--        <tr>-->
<!--            <td width="300px">ID</td>-->
<!--            <td width="100px">Start time</td>-->
<!--            <td width="100px">Duration</td>-->
<!--            <td width="50px"></td>-->
<!--            <td width="50px"></td>-->
<!--        </tr>-->
<!--        <tbody>-->
<!--        <tr th:each="auc: ${auctions}">-->
<!--            <td width="300px" th:text="${auc.getID()}"></td>-->
<!--            <td width="100px" th:text="${auc.getBeginTime()}"></td>-->
<!--            <td width="100px" th:text="${auc.getMaxDuration()}"></td>-->
<!--            <td width="50px"><a th:href="@{/{id}/lotList(id=${auc.getID()})}" >View</a></td>-->
<!--            <td width="50px"><a th:href="@{/{id}/Subscribe(id=${auc.getID()})}" >Subscribe</a></td>-->
<!--        </tr>-->
<!--        </tbody>-->
<!--    </table>-->
<!--</div>-->
<div th:fragment="aucList">
    <table border="1" cellspacing="0">
        <tr>
            <td width="300px" onclick="sortById()">ID</td>
            <td width="100px" onclick="sortByTime()">Start time</td>
            <td width="100px" onclick="sortByDuration()">Duration</td>
            <td width="50px"></td>
            <td width="100px"></td>
        </tr>
        <tbody>
        <tr th:each="auc: ${auctions}">
            <td width="300px" th:text="${auc.getID()}"></td>
            <td width="100px" th:text="${auc.getBeginTime()}"></td>
            <td width="100px" th:text="${auc.getMaxDuration()}"></td>
            <td width="50px">
                <a th:if="${auc.getStringStatus() == 'Planned'}" th:href="@{/{id}/lotList(id=${auc.getID()})}" >View</a>
                <a th:if="${auc.getStringStatus() == 'Active'}" >===></a>
                <a th:unless="${auc.getStringStatus() == 'Active' || auc.getStringStatus() == 'Planned'}" ></a>
            </td>
            <td width="100px">
                <a th:if="${auc.getStringStatus() == 'Planned'}" th:href="@{/{id}/subscribe(id=${auc.getID()})}" >Subscribe</a>
                <a th:if="${auc.getStringStatus() == 'Active'}" th:href="@{/{id}/join(id=${auc.getID()})}" >Join</a>
                <a th:href="@{/{id}/makePlanned(id=${auc.getID()})}" th:unless="${auc.getStringStatus() == 'Active' || auc.getStringStatus() == 'Planned'}" >Make Planned</a>
            </td>
        </tr>
        </tbody>
    </table>
</div>
<div th:fragment="lotList">
    <table border="1" cellspacing="0">
        <tr>
            <td width="100px">ID</td>
            <td width="300px">Name</td>
            <td width="100px">Price</td>
            <td width="50px"></td>
      <!--      <td width="100px">Min price</td>
            <td width="500px">Description</td>  -->
        </tr>
        <tbody>
        <tr th:each="lot: ${auction.getILots()}">
            <td width="100px" th:text="${lot.getID()}"></td>
            <td width="300px" th:text="${lot.getName()}"></td>
            <td width="100px" th:text="${lot.getCurrentPrice()}"></td>
            <td width="50px"><a th:href="@{/{a_id}/{l_id}/lotInfo(a_id=${auction.getID()}, l_id=${lot.getID()})}" >View</a></td>
        <!--    <td width="100px" th:text="${lot.getMin_price()}"></td>
            <td width="500px" th:text="${lot.getDescription()}"></td> -->
        </tr>
        </tbody>
    </table>
</div>
<div th:fragment="purchaseList">
    <table border="1" cellspacing="0">
        <tr>
            <td width="100px">ID</td>
            <td width="300px">Price</td>
            <td width="100px">Buyer</td>
<!--            <td width="50px"></td>-->
            <!--      <td width="100px">Min price</td>
                  <td width="500px">Description</td>  -->
        </tr>
        <tbody>
        <tr th:each="lot: ${lots}">
            <td width="100px" th:text="${lot.getLotId()}"></td>
            <td width="300px" th:text="${lot.getPrice()}"></td>
            <td width="100px" th:text="${lot.getBuyerUsername()}"></td>
<!--            <td width="50px"><a th:href="@{/{a_id}/{l_id}/lotInfo(a_id=${auction.getID()}, l_id=${lot.getID()})}" >View</a></td>-->
            <!--    <td width="100px" th:text="${lot.getMin_price()}"></td>
                <td width="500px" th:text="${lot.getDescription()}"></td> -->
        </tr>
        </tbody>
    </table>
</div>
<div th:fragment="activeAucLotList">
    <table border="1" cellspacing="0">
        <tr>
            <td width="100px">ID</td>
            <td width="300px">Name</td>
            <td width="100px">Price</td>
            <td width="130px"></td>
            <!--      <td width="100px">Min price</td>
                  <td width="500px">Description</td>  -->
        </tr>
        <tbody>
        <tr th:each="lot: ${auction.getILots()}">
            <td width="100px" th:text="${lot.getID()}"></td>
            <td width="300px" th:text="${lot.getName()}"></td>
            <td width="100px" th:text="${lot.getCurrentPrice()}"></td>
            <td width="130px"><input type="button" value="View items" th:onclick="viewItems(${lot.getID()})"></td>
            <!--    <td width="100px" th:text="${lot.getMin_price()}"></td>
                <td width="500px" th:text="${lot.getDescription()}"></td> -->
        </tr>
        </tbody>
    </table>
</div>
<div th:fragment="lotListButtons">
    <table th:if="${auction.getStringStatus() == 'Planned'}">
        <tr>
            <td width="50px"><a th:href="@{/{id}/Subscribe(id=${auction.getID()})}" >Subscribe</a></td>
            <td width="50px"><a sec:authorize="hasRole('ADMIN') || hasRole('SELLER')" th:href="@{/{id}/addLot(id=${auction.getID()})}" >Add lot</a></td>
            <td width="100px"><a sec:authorize="hasRole('ADMIN')" th:href="@{/{id}/deleteLot(id=${auction.getID()})}" >Delete lot</a></td>
        </tr>
    </table>
</div>
<div th:fragment="itemList">
    <table border="1" cellspacing="0">
        <tr>
            <td width="100px" onclick="sortById()">ID</td>
            <td width="100px" onclick="sortByName()">Name</td>
            <td width="500px" onclick="sortByDescription()">Description</td>
            <td width="200px" onclick="sortByStatus()">Status</td>
            <td width="200px">Owner</td>
        </tr>
        <tbody>
        <tr th:each="item: ${items}">
            <td width="100px" th:text="${item.getID()}"></td>
            <td width="100px" th:text="${item.getName()}"></td>
            <td width="500px" th:text="${item.getDescription()}"></td>
            <td width="200px" th:text="${item.getStatus()}"></td>
            <td width="200px" th:text="${item.getOwner()}"></td>
        </tr>
        </tbody>
    </table>
</div>
<div th:fragment="itemListButtons">
    <table>
        <tr>
            <td sec:authorize="hasRole('ADMIN') || hasRole('SELLER')" width="100px"><a th:href="@{/addItem}" >Add item</a></td>
            <td sec:authorize="hasRole('ADMIN') || hasRole('SELLER')" width="100px"><a th:href="@{/deleteItem}" >Delete item</a></td>
        </tr>
    </table>
</div>
<div th:fragment="logout">
    <form action="#" th:action="@{/logout}" method="post">
        <input type="submit" value="Log out"/>
    </form>
</div>
<div th:fragment="loggedAsAndLogout">
    <table>
        <tr>
            <td>Logged as:</td>
            <td width="300px" th:text="${#httpServletRequest.remoteUser}"></td>
            <td><div th:insert="components :: logout" ></div></td>
        </tr>
    </table>
</div>
<div th:fragment="backToList">
    <a th:if="${back}" th:href="@{/{back}(back=${back})}">Back to list</a>
</div>
<div th:fragment="allLotList">
    <table border="1" cellspacing="0">
        <tr>
            <td width="100px" onclick="sortById()">ID</td>
            <td width="300px" onclick="sortByName()">Name</td>
            <td width="100px" onclick="sortByPrice()">Price</td>
            <td width="50px"></td>
            <td width="130px"></td>
            <!--      <td width="100px">Min price</td>
                  <td width="500px">Description</td>  -->
        </tr>
        <tbody>
        <tr th:each="lot: ${lots}">
            <td width="100px" th:text="${lot.getID()}"></td>
            <td width="300px" th:text="${lot.getName()}"></td>
            <td width="100px" th:text="${lot.getCurrentPrice()}"></td>
<!--            TODO buttons-->
            <td width="50px"><a th:href="@{/{a_id}/{l_id}/lotInfo(a_id=${lot.getAuctionId()}, l_id=${lot.getID()})}" >View</a></td>
            <td width="130px"><a th:href="@{/{a_id}/lotList(a_id=${lot.getAuctionId()})}" >To the auction</a></td>
            <!--    <td width="100px" th:text="${lot.getMin_price()}"></td>
                <td width="500px" th:text="${lot.getDescription()}"></td> -->
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>